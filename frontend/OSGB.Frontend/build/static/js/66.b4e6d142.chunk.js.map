{"version":3,"file":"static/js/66.b4e6d142.chunk.js","mappings":"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","sources":["components/VisitsPage.tsx"],"sourcesContent":["import React, { useState, useEffect, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { io, Socket } from 'socket.io-client';\r\nimport { getAllExperts, getExpertAssignedWorkplaces, getExpertVisits } from '../services/api';\r\nimport './VisitsPage.css';\r\n\r\ninterface Expert {\r\n  id: number;\r\n  firstName: string;\r\n  lastName: string;\r\n  phone: string;\r\n  expertiseClass: string;\r\n  assignedMinutes: number;\r\n  usedMinutes: number;\r\n}\r\n\r\ninterface ExpertStats {\r\n  expert: Expert;\r\n  assignedWorkplaceCount: number;\r\n  trackedWorkplaceCount: number;\r\n  totalWorkplaceCount: number;\r\n  currentMonthVisitCount: number;\r\n  remainingWorkplaceCount: number;\r\n}\r\n\r\ninterface Workplace {\r\n  id: number;\r\n  name: string;\r\n  approvalStatus: string;\r\n  // Add other workplace properties as needed\r\n}\r\n\r\ninterface VisitStatus {\r\n  [workplaceId: number]: {\r\n    [month: string]: boolean; // true if visited, false if not\r\n  };\r\n}\r\n\r\n// Function to get the current month name in Turkish\r\nconst getCurrentMonthName = () => {\r\n  const months = [\r\n    'Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran',\r\n    'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'\r\n  ];\r\n  const currentMonthIndex = new Date().getMonth();\r\n  return months[currentMonthIndex];\r\n};\r\n\r\n// Function to get the current month in YYYY-MM format\r\nconst getCurrentMonth = () => {\r\n  const now = new Date();\r\n  const year = now.getFullYear();\r\n  const month = String(now.getMonth() + 1).padStart(2, '0');\r\n  return `${year}-${month}`;\r\n};\r\n\r\n// Function to get all 12 months of a year\r\nconst getAllYearMonths = (year: number) => {\r\n  const months = [];\r\n  const monthNames = [\r\n    'Ocak', 'Şubat', 'Mart', 'Nisan', 'Mayıs', 'Haziran',\r\n    'Temmuz', 'Ağustos', 'Eylül', 'Ekim', 'Kasım', 'Aralık'\r\n  ];\r\n  \r\n  for (let i = 1; i <= 12; i++) {\r\n    const month = String(i).padStart(2, '0');\r\n    months.push({\r\n      value: `${year}-${month}`,\r\n      label: monthNames[i - 1]\r\n    });\r\n  }\r\n  \r\n  return months;\r\n};\r\n\r\nconst VisitsPage: React.FC = () => {\r\n  const navigate = useNavigate();\r\n  const [experts, setExperts] = useState<Expert[]>([]);\r\n  const [expertStats, setExpertStats] = useState<ExpertStats[]>([]);\r\n  const [loading, setLoading] = useState<boolean>(true);\r\n  const [error, setError] = useState<string>('');\r\n  const socketRef = useRef<Socket | null>(null);\r\n  const currentMonthName = getCurrentMonthName();\r\n\r\n  // State for expert popup modal\r\n  const [isExpertModalOpen, setIsExpertModalOpen] = useState<boolean>(false);\r\n  const [selectedExpert, setSelectedExpert] = useState<Expert | null>(null);\r\n  const [trackedWorkplaces, setTrackedWorkplaces] = useState<Workplace[]>([]);\r\n  const [workplacesLoading, setWorkplacesLoading] = useState<boolean>(false);\r\n  const [visitStatus, setVisitStatus] = useState<VisitStatus>({});\r\n  const [currentYear] = useState<number>(new Date().getFullYear());\r\n\r\n  useEffect(() => {\r\n    fetchExpertsWithStats();\r\n    \r\n    // Initialize WebSocket connection\r\n    socketRef.current = io('http://localhost:5001');\r\n    \r\n    // Listen for visit updates\r\n    if (socketRef.current) {\r\n      socketRef.current.on('visitUpdate', (data) => {\r\n        // Update visit status in real-time\r\n        setVisitStatus(prev => {\r\n          const newStatus = { ...prev };\r\n          if (!newStatus[data.workplaceId]) {\r\n            newStatus[data.workplaceId] = {};\r\n          }\r\n          newStatus[data.workplaceId][data.visitMonth] = data.visited;\r\n          return newStatus;\r\n        });\r\n      });\r\n    }\r\n    \r\n    // Clean up WebSocket connection\r\n    return () => {\r\n      if (socketRef.current) {\r\n        socketRef.current.disconnect();\r\n      }\r\n    };\r\n  }, []);\r\n\r\n  useEffect(() => {\r\n    if (isExpertModalOpen && selectedExpert) {\r\n      fetchTrackedWorkplaces(selectedExpert.id);\r\n    }\r\n  }, [isExpertModalOpen, selectedExpert]);\r\n\r\n  const fetchExpertsWithStats = async () => {\r\n    try {\r\n      setLoading(true);\r\n      const expertsData = await getAllExperts();\r\n      setExperts(expertsData);\r\n      \r\n      // Fetch stats for each expert\r\n      const statsPromises = expertsData.map(async (expert: Expert) => {\r\n        try {\r\n          // Get assigned workplaces\r\n          const assignedWorkplaces = await getExpertAssignedWorkplaces(expert.id);\r\n          \r\n          // For demo purposes, we'll use placeholder values since we don't have real data\r\n          // In a real implementation, you would calculate these values based on actual data\r\n          return {\r\n            expert,\r\n            assignedWorkplaceCount: assignedWorkplaces.length,\r\n            trackedWorkplaceCount: Math.floor(assignedWorkplaces.length * 0.8), // 80% for demo\r\n            totalWorkplaceCount: assignedWorkplaces.length,\r\n            currentMonthVisitCount: Math.floor(assignedWorkplaces.length * 0.6), // 60% for demo\r\n            remainingWorkplaceCount: Math.ceil(assignedWorkplaces.length * 0.4) // 40% for demo\r\n          };\r\n        } catch (err) {\r\n          // Return default values if there's an error fetching stats\r\n          return {\r\n            expert,\r\n            assignedWorkplaceCount: 0,\r\n            trackedWorkplaceCount: 0,\r\n            totalWorkplaceCount: 0,\r\n            currentMonthVisitCount: 0,\r\n            remainingWorkplaceCount: 0\r\n          };\r\n        }\r\n      });\r\n      \r\n      const statsData = await Promise.all(statsPromises);\r\n      setExpertStats(statsData);\r\n      setError('');\r\n    } catch (err: any) {\r\n      console.error('Error fetching experts:', err);\r\n      setError('Uzmanlar getirilirken hata oluştu: ' + (err.message || ''));\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchTrackedWorkplaces = async (expertId: number) => {\r\n    try {\r\n      setWorkplacesLoading(true);\r\n      const workplacesData = await getExpertAssignedWorkplaces(expertId);\r\n      // Show all workplaces (not just approved ones) for debugging\r\n      setTrackedWorkplaces(workplacesData);\r\n      \r\n      // Fetch visit data for all workplaces\r\n      await fetchVisitData(expertId, workplacesData);\r\n    } catch (err: any) {\r\n      console.error('Error fetching tracked workplaces:', err);\r\n      setError('İş yerleri getirilirken hata oluştu: ' + (err.message || ''));\r\n    } finally {\r\n      setWorkplacesLoading(false);\r\n    }\r\n  };\r\n\r\n  const fetchVisitData = async (expertId: number, workplaces: Workplace[]) => {\r\n    try {\r\n      const visitData = await getExpertVisits(expertId);\r\n      \r\n      // Initialize visit status from backend data\r\n      const initialStatus: VisitStatus = {};\r\n      workplaces.forEach((workplace) => {\r\n        initialStatus[workplace.id] = {};\r\n        getAllYearMonths(currentYear).forEach(month => {\r\n          // Check if we have visit data for this workplace and month\r\n          if (visitData[workplace.id] && visitData[workplace.id].visits && visitData[workplace.id].visits[month.value]) {\r\n            initialStatus[workplace.id][month.value] = visitData[workplace.id].visits[month.value].visited;\r\n          } else {\r\n            // Default to not visited if no data exists\r\n            initialStatus[workplace.id][month.value] = false;\r\n          }\r\n        });\r\n      });\r\n      \r\n      setVisitStatus(initialStatus);\r\n    } catch (err: any) {\r\n      console.error('Error fetching visit data:', err);\r\n      setError('Ziyaret verileri getirilirken hata oluştu: ' + (err.message || ''));\r\n    }\r\n  };\r\n\r\n  // Function to open expert modal\r\n  const openExpertModal = (expert: Expert) => {\r\n    setSelectedExpert(expert);\r\n    setIsExpertModalOpen(true);\r\n  };\r\n\r\n  // Function to close expert modal\r\n  const closeExpertModal = () => {\r\n    setIsExpertModalOpen(false);\r\n    setSelectedExpert(null);\r\n    setTrackedWorkplaces([]);\r\n    setVisitStatus({});\r\n  };\r\n\r\n  // Calculate total statistics\r\n  const calculateTotalStats = () => {\r\n    return expertStats.reduce((totals, stat) => {\r\n      return {\r\n        totalWorkplaces: totals.totalWorkplaces + stat.totalWorkplaceCount,\r\n        visitedWorkplaces: totals.visitedWorkplaces + stat.currentMonthVisitCount,\r\n        remainingWorkplaces: totals.remainingWorkplaces + stat.remainingWorkplaceCount\r\n      };\r\n    }, { totalWorkplaces: 0, visitedWorkplaces: 0, remainingWorkplaces: 0 });\r\n  };\r\n\r\n  const totalStats = calculateTotalStats();\r\n\r\n  if (loading) {\r\n    return (\r\n      <div className=\"visits-page-container\">\r\n        <div className=\"page-header\">\r\n          <h2>Ziyaretler</h2>\r\n        </div>\r\n        <div className=\"loading\">Yükleniyor...</div>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  if (error) {\r\n    return (\r\n      <div className=\"visits-page-container\">\r\n        <div className=\"page-header\">\r\n          <h2>Ziyaretler</h2>\r\n        </div>\r\n        <div className=\"error\">{error}</div>\r\n        <button className=\"btn btn-primary\" onClick={() => navigate('/')}>\r\n          Ana Sayfaya Dön\r\n        </button>\r\n      </div>\r\n    );\r\n  }\r\n\r\n  return (\r\n    <div className=\"visits-page-container\">\r\n      <div className=\"page-header\">\r\n        <h2>Ziyaretler</h2>\r\n      </div>\r\n\r\n      {/* Header row with proper alignment */}\r\n      <div className=\"expert-header\">\r\n        <div className=\"expert-header-item\">Ad Soyad</div>\r\n        <div className=\"expert-header-item class-shifted\">Sınıfı</div>\r\n        <div className=\"expert-header-item assigned-vertical\">\r\n          <span>Atanan</span>\r\n          <span>İşyerleri</span>\r\n        </div>\r\n        <div className=\"expert-header-item\">\r\n          <span>Takip edilecek</span>\r\n          <span>  İşyerleri</span>\r\n        </div>\r\n        <div className=\"expert-header-item minutes-vertical\">\r\n          <span>Gerçekleşen</span>\r\n          <span>  Ziyaretler</span>\r\n        </div>\r\n        <div className=\"expert-header-item minutes-vertical\">\r\n          <span>Kalan</span>\r\n          <span>  Ziyaretler</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Expert rows with proper alignment */}\r\n      <div className=\"expert-list\">\r\n        {expertStats.map((stat) => (\r\n          <div \r\n            key={stat.expert.id} \r\n            className=\"expert-row\"\r\n            onClick={() => openExpertModal(stat.expert)}\r\n          >\r\n            <div className=\"expert-info\">\r\n              <div className=\"expert-name\">{stat.expert.firstName} {stat.expert.lastName}</div>\r\n              <div className={`expert-class ${stat.expert.expertiseClass.toLowerCase()}`}>\r\n                {stat.expert.expertiseClass}\r\n              </div>\r\n              <div className=\"expert-assigned\">{stat.assignedWorkplaceCount}</div>\r\n              <div className=\"expert-remaining\">{stat.trackedWorkplaceCount}</div>\r\n              <div className=\"expert-minutes\">{stat.currentMonthVisitCount}</div>\r\n              <div className=\"expert-minutes\">{stat.remainingWorkplaceCount}</div>\r\n            </div>\r\n          </div>\r\n        ))}\r\n      </div>\r\n\r\n      {expertStats.length === 0 && (\r\n        <div className=\"no-workplaces\">Kayıtlı uzman bulunamadı</div>\r\n      )}\r\n\r\n      {/* Statistics panel */}\r\n      <div className=\"statistics-panel\">\r\n        <h3 className=\"statistics-header\">Ziyaret İstatistikleri</h3>\r\n        <div className=\"statistics-content\">\r\n          <div className=\"stat-item\">\r\n            <span className=\"stat-label\">{currentMonthName} ayında ziyaret edilmesi gereken</span>\r\n            <span className=\"stat-value\">{totalStats.totalWorkplaces}</span>\r\n          </div>\r\n          <div className=\"stat-item\">\r\n            <span className=\"stat-label\">{currentMonthName} ayından ziyareti yapılan işletme sayısı:</span>\r\n            <span className=\"stat-value\">{totalStats.visitedWorkplaces}</span>\r\n          </div>\r\n          <div className=\"stat-item\">\r\n            <span className=\"stat-label\">{currentMonthName} ayında ziyareti kalan işletme sayısı:</span>\r\n            <span className=\"stat-value\">{totalStats.remainingWorkplaces}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n\r\n      {/* Expert Modal Popup */}\r\n      {isExpertModalOpen && selectedExpert && (\r\n        <div className=\"expert-modal-overlay\" onClick={closeExpertModal}>\r\n          <div className=\"expert-modal-content\" onClick={(e) => e.stopPropagation()}>\r\n            <div className=\"expert-modal-header\">\r\n              <h2 className=\"expert-name-display\">{selectedExpert.firstName} {selectedExpert.lastName}</h2>\r\n              <button className=\"expert-modal-close\" onClick={closeExpertModal}>×</button>\r\n            </div>\r\n            <div className=\"expert-modal-body\">\r\n              <div className=\"year-calendar-section\">\r\n                <h3>{currentYear} Yılı Ziyaret Takvimi</h3>\r\n                {workplacesLoading ? (\r\n                  <p>Yükleniyor...</p>\r\n                ) : error ? (\r\n                  <p className=\"error\">{error}</p>\r\n                ) : trackedWorkplaces.length > 0 ? (\r\n                  <div className=\"workplaces-calendar\">\r\n                    {trackedWorkplaces.map((workplace) => (\r\n                      <div key={workplace.id} className=\"workplace-calendar\">\r\n                        <div className=\"workplace-name\">{workplace.name}</div>\r\n                        <div className=\"months-grid\">\r\n                          {getAllYearMonths(currentYear).map((month) => {\r\n                            const isVisited = visitStatus[workplace.id]?.[month.value] || false;\r\n                            return (\r\n                              <div \r\n                                key={month.value} \r\n                                className={`month-box ${isVisited ? 'visited' : 'not-visited'}`}\r\n                                title={`${month.label} ${currentYear}: ${isVisited ? 'Ziyaret Edildi' : 'Ziyaret Edilmedi'}`}\r\n                              >\r\n                                <span className=\"month-label\">{month.label.charAt(0)}</span>\r\n                              </div>\r\n                            );\r\n                          })}\r\n                        </div>\r\n                      </div>\r\n                    ))}\r\n                  </div>\r\n                ) : (\r\n                  <p>Seçilen uzmanın takip edeceği iş yeri bulunamadı.</p>\r\n                )}\r\n              </div>\r\n            </div>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default VisitsPage;"],"names":["getAllYearMonths","year","months","monthNames","i","month","String","padStart","push","value","concat","label","VisitsPage","navigate","useNavigate","experts","setExperts","useState","expertStats","setExpertStats","loading","setLoading","error","setError","socketRef","useRef","currentMonthName","Date","getMonth","isExpertModalOpen","setIsExpertModalOpen","selectedExpert","setSelectedExpert","trackedWorkplaces","setTrackedWorkplaces","workplacesLoading","setWorkplacesLoading","visitStatus","setVisitStatus","currentYear","getFullYear","useEffect","fetchExpertsWithStats","current","io","on","data","prev","newStatus","_objectSpread","workplaceId","visitMonth","visited","disconnect","fetchTrackedWorkplaces","id","async","expertsData","getAllExperts","statsPromises","map","assignedWorkplaces","getExpertAssignedWorkplaces","expert","assignedWorkplaceCount","length","trackedWorkplaceCount","Math","floor","totalWorkplaceCount","currentMonthVisitCount","remainingWorkplaceCount","ceil","err","statsData","Promise","all","console","message","workplacesData","expertId","fetchVisitData","workplaces","visitData","getExpertVisits","initialStatus","forEach","workplace","visits","closeExpertModal","totalStats","reduce","totals","stat","totalWorkplaces","visitedWorkplaces","remainingWorkplaces","_jsxs","className","children","_jsx","onClick","openExpertModal","firstName","lastName","expertiseClass","toLowerCase","e","stopPropagation","name","_visitStatus$workplac","isVisited","title","charAt"],"sourceRoot":""}