"use strict";(self.webpackChunkosgb_frontend=self.webpackChunkosgb_frontend||[]).push([[66],{685:(e,a,s)=>{s.r(a),s.d(a,{default:()=>o});var t=s(555),i=s(43),r=s(216),l=s(104),n=s(291),c=s(579);const d=e=>{const a=[],s=["Ocak","\u015eubat","Mart","Nisan","May\u0131s","Haziran","Temmuz","A\u011fustos","Eyl\xfcl","Ekim","Kas\u0131m","Aral\u0131k"];for(let t=1;t<=12;t++){const i=String(t).padStart(2,"0");a.push({value:"".concat(e,"-").concat(i),label:s[t-1]})}return a},o=()=>{const e=(0,r.Zp)(),[a,s]=(0,i.useState)([]),[o,h]=(0,i.useState)([]),[m,p]=(0,i.useState)(!0),[x,u]=(0,i.useState)(""),v=(0,i.useRef)(null),j=["Ocak","\u015eubat","Mart","Nisan","May\u0131s","Haziran","Temmuz","A\u011fustos","Eyl\xfcl","Ekim","Kas\u0131m","Aral\u0131k"][(new Date).getMonth()],[k,N]=(0,i.useState)(!1),[y,g]=(0,i.useState)(null),[C,f]=(0,i.useState)([]),[W,b]=(0,i.useState)(!1),[w,S]=(0,i.useState)({}),[E]=(0,i.useState)((new Date).getFullYear());(0,i.useEffect)(()=>(M(),v.current=(0,l.io)("http://localhost:5001"),v.current&&v.current.on("visitUpdate",e=>{S(a=>{const s=(0,t.A)({},a);return s[e.workplaceId]||(s[e.workplaceId]={}),s[e.workplaceId][e.visitMonth]=e.visited,s})}),()=>{v.current&&v.current.disconnect()}),[]),(0,i.useEffect)(()=>{k&&y&&z(y.id)},[k,y]);const M=async()=>{try{p(!0);const e=await(0,n.Xk)();s(e);const a=e.map(async e=>{try{const a=await(0,n.qz)(e.id);return{expert:e,assignedWorkplaceCount:a.length,trackedWorkplaceCount:Math.floor(.8*a.length),totalWorkplaceCount:a.length,currentMonthVisitCount:Math.floor(.6*a.length),remainingWorkplaceCount:Math.ceil(.4*a.length)}}catch(a){return{expert:e,assignedWorkplaceCount:0,trackedWorkplaceCount:0,totalWorkplaceCount:0,currentMonthVisitCount:0,remainingWorkplaceCount:0}}}),t=await Promise.all(a);h(t),u("")}catch(e){console.error("Error fetching experts:",e),u("Uzmanlar getirilirken hata olu\u015ftu: "+(e.message||""))}finally{p(!1)}},z=async e=>{try{b(!0);const a=await(0,n.qz)(e);f(a),await Z(e,a)}catch(a){console.error("Error fetching tracked workplaces:",a),u("\u0130\u015f yerleri getirilirken hata olu\u015ftu: "+(a.message||""))}finally{b(!1)}},Z=async(e,a)=>{try{const s=await(0,n.vc)(e),t={};a.forEach(e=>{t[e.id]={},d(E).forEach(a=>{s[e.id]&&s[e.id].visits&&s[e.id].visits[a.value]?t[e.id][a.value]=s[e.id].visits[a.value].visited:t[e.id][a.value]=!1})}),S(t)}catch(s){console.error("Error fetching visit data:",s),u("Ziyaret verileri getirilirken hata olu\u015ftu: "+(s.message||""))}},A=()=>{N(!1),g(null),f([]),S({})},K=o.reduce((e,a)=>({totalWorkplaces:e.totalWorkplaces+a.totalWorkplaceCount,visitedWorkplaces:e.visitedWorkplaces+a.currentMonthVisitCount,remainingWorkplaces:e.remainingWorkplaces+a.remainingWorkplaceCount}),{totalWorkplaces:0,visitedWorkplaces:0,remainingWorkplaces:0});return m?(0,c.jsxs)("div",{className:"visits-page-container",children:[(0,c.jsx)("div",{className:"page-header",children:(0,c.jsx)("h2",{children:"Ziyaretler"})}),(0,c.jsx)("div",{className:"loading",children:"Y\xfckleniyor..."})]}):x?(0,c.jsxs)("div",{className:"visits-page-container",children:[(0,c.jsx)("div",{className:"page-header",children:(0,c.jsx)("h2",{children:"Ziyaretler"})}),(0,c.jsx)("div",{className:"error",children:x}),(0,c.jsx)("button",{className:"btn btn-primary",onClick:()=>e("/"),children:"Ana Sayfaya D\xf6n"})]}):(0,c.jsxs)("div",{className:"visits-page-container",children:[(0,c.jsx)("div",{className:"page-header",children:(0,c.jsx)("h2",{children:"Ziyaretler"})}),(0,c.jsxs)("div",{className:"expert-header",children:[(0,c.jsx)("div",{className:"expert-header-item",children:"Ad Soyad"}),(0,c.jsx)("div",{className:"expert-header-item class-shifted",children:"S\u0131n\u0131f\u0131"}),(0,c.jsxs)("div",{className:"expert-header-item assigned-vertical",children:[(0,c.jsx)("span",{children:"Atanan"}),(0,c.jsx)("span",{children:"\u0130\u015fyerleri"})]}),(0,c.jsxs)("div",{className:"expert-header-item",children:[(0,c.jsx)("span",{children:"Takip edilecek"}),(0,c.jsx)("span",{children:"  \u0130\u015fyerleri"})]}),(0,c.jsxs)("div",{className:"expert-header-item minutes-vertical",children:[(0,c.jsx)("span",{children:"Ger\xe7ekle\u015fen"}),(0,c.jsx)("span",{children:"  Ziyaretler"})]}),(0,c.jsxs)("div",{className:"expert-header-item minutes-vertical",children:[(0,c.jsx)("span",{children:"Kalan"}),(0,c.jsx)("span",{children:"  Ziyaretler"})]})]}),(0,c.jsx)("div",{className:"expert-list",children:o.map(e=>(0,c.jsx)("div",{className:"expert-row",onClick:()=>{return a=e.expert,g(a),void N(!0);var a},children:(0,c.jsxs)("div",{className:"expert-info",children:[(0,c.jsxs)("div",{className:"expert-name",children:[e.expert.firstName," ",e.expert.lastName]}),(0,c.jsx)("div",{className:"expert-class ".concat(e.expert.expertiseClass.toLowerCase()),children:e.expert.expertiseClass}),(0,c.jsx)("div",{className:"expert-assigned",children:e.assignedWorkplaceCount}),(0,c.jsx)("div",{className:"expert-remaining",children:e.trackedWorkplaceCount}),(0,c.jsx)("div",{className:"expert-minutes",children:e.currentMonthVisitCount}),(0,c.jsx)("div",{className:"expert-minutes",children:e.remainingWorkplaceCount})]})},e.expert.id))}),0===o.length&&(0,c.jsx)("div",{className:"no-workplaces",children:"Kay\u0131tl\u0131 uzman bulunamad\u0131"}),(0,c.jsxs)("div",{className:"statistics-panel",children:[(0,c.jsx)("h3",{className:"statistics-header",children:"Ziyaret \u0130statistikleri"}),(0,c.jsxs)("div",{className:"statistics-content",children:[(0,c.jsxs)("div",{className:"stat-item",children:[(0,c.jsxs)("span",{className:"stat-label",children:[j," ay\u0131nda ziyaret edilmesi gereken"]}),(0,c.jsx)("span",{className:"stat-value",children:K.totalWorkplaces})]}),(0,c.jsxs)("div",{className:"stat-item",children:[(0,c.jsxs)("span",{className:"stat-label",children:[j," ay\u0131ndan ziyareti yap\u0131lan i\u015fletme say\u0131s\u0131:"]}),(0,c.jsx)("span",{className:"stat-value",children:K.visitedWorkplaces})]}),(0,c.jsxs)("div",{className:"stat-item",children:[(0,c.jsxs)("span",{className:"stat-label",children:[j," ay\u0131nda ziyareti kalan i\u015fletme say\u0131s\u0131:"]}),(0,c.jsx)("span",{className:"stat-value",children:K.remainingWorkplaces})]})]})]}),k&&y&&(0,c.jsx)("div",{className:"expert-modal-overlay",onClick:A,children:(0,c.jsxs)("div",{className:"expert-modal-content",onClick:e=>e.stopPropagation(),children:[(0,c.jsxs)("div",{className:"expert-modal-header",children:[(0,c.jsxs)("h2",{className:"expert-name-display",children:[y.firstName," ",y.lastName]}),(0,c.jsx)("button",{className:"expert-modal-close",onClick:A,children:"\xd7"})]}),(0,c.jsx)("div",{className:"expert-modal-body",children:(0,c.jsxs)("div",{className:"year-calendar-section",children:[(0,c.jsxs)("h3",{children:[E," Y\u0131l\u0131 Ziyaret Takvimi"]}),W?(0,c.jsx)("p",{children:"Y\xfckleniyor..."}):x?(0,c.jsx)("p",{className:"error",children:x}):C.length>0?(0,c.jsx)("div",{className:"workplaces-calendar",children:C.map(e=>(0,c.jsxs)("div",{className:"workplace-calendar",children:[(0,c.jsx)("div",{className:"workplace-name",children:e.name}),(0,c.jsx)("div",{className:"months-grid",children:d(E).map(a=>{var s;const t=(null===(s=w[e.id])||void 0===s?void 0:s[a.value])||!1;return(0,c.jsx)("div",{className:"month-box ".concat(t?"visited":"not-visited"),title:"".concat(a.label," ").concat(E,": ").concat(t?"Ziyaret Edildi":"Ziyaret Edilmedi"),children:(0,c.jsx)("span",{className:"month-label",children:a.label.charAt(0)})},a.value)})})]},e.id))}):(0,c.jsx)("p",{children:"Se\xe7ilen uzman\u0131n takip edece\u011fi i\u015f yeri bulunamad\u0131."})]})})]})})]})}}}]);
//# sourceMappingURL=66.b4e6d142.chunk.js.map